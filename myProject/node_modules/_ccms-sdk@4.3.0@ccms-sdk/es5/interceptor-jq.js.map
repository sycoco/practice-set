{"version":3,"file":"interceptor-jq.js","sources":["webpack:///webpack/bootstrap 49b9b5c86d802bdd70cd?1139","webpack:///./src/interceptors/shell-jq.js","webpack:///external \"angular\"?11d2","webpack:///./src/interceptors/token-refresh-interceptor.js?23f9","webpack:///./src/credentials/index.js?013c","webpack:///./~/js-cookie/src/js.cookie.js?648a","webpack:///./src/interceptors/metadata.js?e373","webpack:///./~/angular-es-utils/injector/index.js?6ae8","webpack:///./~/angular-es-utils/dynamic-export/index.js?bcbb","webpack:///./src/interceptors/token-refresh-interceptor-jq.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 49b9b5c86d802bdd70cd","'use strict';\n\nvar _tokenRefreshInterceptorJq = require('./token-refresh-interceptor-jq');\n\nvar _tokenRefreshInterceptorJq2 = _interopRequireDefault(_tokenRefreshInterceptorJq);\n\nvar _tokenRefreshInterceptor = require('./token-refresh-interceptor');\n\nvar _credentials = require('../credentials');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// 为es5提供调用\nif (!window.ccmsSdk) window.ccmsSdk = {}; /**\n                                           * @author shuyun\n                                           * @homepage http://github.com/qixman\n                                           * @date 2016/11/16\n                                           */\n/**\n * @author qix\n * @homepage https://github.com/qixman/\n * @since 2016-11-16\n */\n\nObject.assign(window.ccmsSdk, {\n  tokenRefreshInterceptor: _tokenRefreshInterceptorJq2.default,\n  $ccmsAuth: {\n    setAuthFailedBehavior: _tokenRefreshInterceptor.setAuthFailedBehavior,\n    setRefreshTokenUrl: _tokenRefreshInterceptor.setRefreshTokenUrl,\n    getRequestCredential: _credentials.getRequestCredential,\n    setRequestCredential: _credentials.setRequestCredential\n  }\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/interceptors/shell-jq.js\n// module id = 0\n// module chunks = 2 3","module.exports = angular;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"angular\"\n// module id = 1\n// module chunks = 0 1 2 3","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.refreshTokenUrl = exports.execAuthFailure = undefined;\nexports.setAuthFailedBehavior = setAuthFailedBehavior;\nexports.setRefreshTokenUrl = setRefreshTokenUrl;\n\nvar _credentials = require('../credentials');\n\nvar _metadata = require('./metadata');\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; } /**\n                                                                                                                                                                                                                   * @author Kuitos\n                                                                                                                                                                                                                   * @homepage https://github.com/kuitos/\n                                                                                                                                                                                                                   * @since 2016-09-09\n                                                                                                                                                                                                                   */\n\n\nvar needToRefreshToken = false;\n\nvar execAuthFailure = exports.execAuthFailure = function execAuthFailure() {};\nfunction setAuthFailedBehavior() {\n\tvar fn = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : execAuthFailure;\n\n\n\texports.execAuthFailure = execAuthFailure = function execAuthFailure(rejection) {\n\n\t\ttry {\n\t\t\tfn();\n\t\t} finally {\n\t\t\t(0, _credentials.removeRequestCredential)();\n\t\t}\n\n\t\tvar ex = new TypeError('Unauthorized! Credential was expired or had been removed, pls set it before the get action!');\n\t\tconsole.error(ex);\n\n\t\t// 兼容 jquery 处理\n\t\tif (typeof rejection.abort === 'function') {\n\t\t\trejection.abort(ex);\n\t\t} else {\n\t\t\trejection.status = rejection.status || 401;\n\t\t\trejection.statusText = rejection.statusText || 'Unauthorized!';\n\t\t\tvar injector = require('angular-es-utils/injector').default;\n\t\t\treturn injector.get('$q').reject(rejection);\n\t\t}\n\t};\n}\n\nvar refreshTokenUrl = exports.refreshTokenUrl = '';\nfunction setRefreshTokenUrl(url) {\n\texports.refreshTokenUrl = refreshTokenUrl = url;\n\t_metadata.REQUEST_WHITE_LIST.push(url);\n}\n\nexports.default = {\n\trequest: function request(config) {\n\n\t\tvar credential = (0, _credentials.getRequestCredential)();\n\t\tvar accessToken = _metadata.CREDENTIAL_KEY_MAPPER.accessToken,\n\t\t    refreshToken = _metadata.CREDENTIAL_KEY_MAPPER.refreshToken,\n\t\t    expireTime = _metadata.CREDENTIAL_KEY_MAPPER.expireTime;\n\t\t// storage 里的状态有可能已经失效\n\n\t\tif (!credential) {\n\t\t\treturn execAuthFailure({ config: config });\n\t\t}\n\n\t\tconfig.headers[_metadata.REQUEST_TOKEN_HEADER] = (0, _metadata.REQUEST_TOKEN_VALUE)(credential[accessToken]);\n\n\t\t// 白名单之外的url做校验\n\t\t// TODO 兼容处理,如果拿不到refreshToken说明系统还未升级,则不做刷新token逻辑\n\t\tif (credential[refreshToken] && _metadata.REQUEST_WHITE_LIST.indexOf(config.url) === -1) {\n\n\t\t\t// expireTime type is second\n\t\t\tvar expireDateTime = credential[expireTime] * 1000;\n\t\t\tvar now = _metadata.Date.now();\n\n\t\t\t// token失效则直接跳转登录页面\n\t\t\t// token未失效但是可用时长已低于用户会话最短保留时间,则需要刷新token\n\t\t\tif (_metadata.USER_SESSION_AVAILABLE_TIME >= expireDateTime - now && expireDateTime - now >= 0) {\n\t\t\t\tneedToRefreshToken = true;\n\t\t\t} else if (expireDateTime - now < 0) {\n\t\t\t\t// token失效\n\t\t\t\treturn execAuthFailure({ config: config });\n\t\t\t}\n\t\t}\n\n\t\treturn config;\n\t},\n\tresponse: function response(_response) {\n\n\t\t// 如果请求能正常响应,说明 storage 里的状态是存在的,所以这里不做判断\n\t\tvar credential = (0, _credentials.getRequestCredential)();\n\t\tvar accessToken = _metadata.CREDENTIAL_KEY_MAPPER.accessToken,\n\t\t    refreshToken = _metadata.CREDENTIAL_KEY_MAPPER.refreshToken;\n\n\n\t\tvar injector = require('angular-es-utils/injector').default;\n\t\tvar $http = injector.get('$http');\n\t\tvar $httpParamSerializerJQLike = injector.get('$httpParamSerializerJQLike');\n\t\t// 所有请求结束了才做refreshToken的操作,避免后端因为token被刷新而导致前一请求失败\n\t\tif (needToRefreshToken && $http.pendingRequests.length === 0) {\n\n\t\t\tneedToRefreshToken = false;\n\t\t\t// refresh token\n\t\t\t$http.post(refreshTokenUrl, $httpParamSerializerJQLike({ refresh_token: credential[refreshToken], grant_type: 'refresh_token' }), {\n\t\t\t\theaders: _defineProperty({\n\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded'\n\t\t\t\t}, _metadata.REQUEST_TOKEN_HEADER, (0, _metadata.REQUEST_TOKEN_VALUE)(credential[accessToken]))\n\t\t\t}).then(function (response) {\n\t\t\t\t// 更新localStorage中token信息\n\t\t\t\t(0, _credentials.setRequestCredential)(response.data);\n\t\t\t}, execAuthFailure).catch(function (rejection) {\n\t\t\t\treturn console.error(rejection);\n\t\t\t});\n\t\t}\n\n\t\treturn _response;\n\t}\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/interceptors/token-refresh-interceptor.js\n// module id = 3\n// module chunks = 0 1 2 3","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.getRequestCredential = getRequestCredential;\nexports.setRequestCredential = setRequestCredential;\nexports.removeRequestCredential = removeRequestCredential;\n\nvar _jsCookie = require('js-cookie');\n\nvar _jsCookie2 = _interopRequireDefault(_jsCookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar localStorage = window.localStorage; /**\n                                         * @author Kuitos\n                                         * @homepage https://github.com/kuitos/\n                                         * @since 2016-09-29\n                                         */\n\nvar JSON = window.JSON;\n\nvar REQUEST_TOKEN_STORAGE_KEY = 'ccmsRequestCredential';\n\nfunction getRequestCredential() {\n\n\tvar credential = null;\n\t// get credential from cookie when inside an iframe\n\tif (window.self !== window.top) {\n\t\tcredential = _jsCookie2.default.get(REQUEST_TOKEN_STORAGE_KEY) || null;\n\t} else {\n\t\tcredential = localStorage.getItem(REQUEST_TOKEN_STORAGE_KEY) || null;\n\t}\n\n\treturn JSON.parse(credential);\n}\n\nfunction setRequestCredential(credential) {\n\tlocalStorage.setItem(REQUEST_TOKEN_STORAGE_KEY, JSON.stringify(credential));\n\t_jsCookie2.default.set(REQUEST_TOKEN_STORAGE_KEY, JSON.stringify(credential));\n}\n\nfunction removeRequestCredential() {\n\tlocalStorage.removeItem(REQUEST_TOKEN_STORAGE_KEY);\n\t_jsCookie2.default.remove(REQUEST_TOKEN_STORAGE_KEY);\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/credentials/index.js\n// module id = 4\n// module chunks = 0 1 2 3","/*!\n * JavaScript Cookie v2.1.4\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tvar registeredInModuleLoader = false;\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (!registeredInModuleLoader) {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\t// We're using \"expires\" because \"max-age\" is not supported by IE\n\t\t\t\tattributes.expires = attributes.expires ? attributes.expires.toUTCString() : '';\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\tvar stringifiedAttributes = '';\n\n\t\t\t\tfor (var attributeName in attributes) {\n\t\t\t\t\tif (!attributes[attributeName]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '; ' + attributeName;\n\t\t\t\t\tif (attributes[attributeName] === true) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '=' + attributes[attributeName];\n\t\t\t\t}\n\t\t\t\treturn (document.cookie = key + '=' + value + stringifiedAttributes);\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.set = api;\n\t\tapi.get = function (key) {\n\t\t\treturn api.call(api, key);\n\t\t};\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/js-cookie/src/js.cookie.js\n// module id = 5\n// module chunks = 0 1 2 3","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CREDENTIAL_KEY_MAPPER = exports.REQUEST_WHITE_LIST = exports.USER_SESSION_AVAILABLE_TIME = exports.REQUEST_TOKEN_VALUE = exports.REQUEST_TOKEN_HEADER = exports.noop = exports.Date = undefined;\n\nvar _credentials = require('../credentials');\n\nvar credential = (0, _credentials.getRequestCredential)(); /**\n                                                            * @author qix\n                                                            * @homepage https://github.com/qixman/\n                                                            * @since 2016-10-21\n                                                            */\nvar Date = exports.Date = window.Date;\nvar noop = exports.noop = function noop() {};\nvar REQUEST_TOKEN_HEADER = exports.REQUEST_TOKEN_HEADER = 'Authorization';\nvar REQUEST_TOKEN_VALUE = exports.REQUEST_TOKEN_VALUE = function REQUEST_TOKEN_VALUE(value) {\n  return 'Bearer ' + value;\n};\n// export const USER_SESSION_AVAILABLE_TIME = 30 * 60 * 1000;\nvar USER_SESSION_AVAILABLE_TIME = exports.USER_SESSION_AVAILABLE_TIME = credential && credential['expires_in'] ? credential['expires_in'] * 1000 / 2 : 30 * 60 * 1000;\nvar REQUEST_WHITE_LIST = exports.REQUEST_WHITE_LIST = [];\nvar CREDENTIAL_KEY_MAPPER = exports.CREDENTIAL_KEY_MAPPER = {\n  accessToken: 'access_token',\n  refreshToken: 'refresh_token',\n  expireTime: 'expire_time'\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/interceptors/metadata.js\n// module id = 6\n// module chunks = 0 1 2 3","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\nexports.getInjector = getInjector;\n\nvar _angular = require('angular');\n\nvar _angular2 = _interopRequireDefault(_angular);\n\nvar _dynamicExport = require('../dynamic-export');\n\nvar _dynamicExport2 = _interopRequireDefault(_dynamicExport);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * 获取应用的injector,默认查询被ng-app标记的节点,否则从document.documentElement开始找\n * @param rootElement\n */\n/**\n * @author Kuitos\n * @homepage https://github.com/kuitos/\n * @since 2016-04-25\n */\n\nfunction getInjector() {\n\tvar rootElement = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document.querySelector('[ng-app]') || document.documentElement;\n\n\n\tvar injector = _angular2.default.element(rootElement).injector();\n\n\tif (injector) {\n\t\treturn injector;\n\t} else {\n\n\t\tvar childNodes = rootElement.childNodes;\n\n\t\tfor (var i = 0; i < childNodes.length; i++) {\n\n\t\t\tvar _injector = getInjector(childNodes[i]);\n\n\t\t\tif (_injector) {\n\t\t\t\treturn _injector;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\n// make commonjs have the same behavior with es6 module\nvar injector = null;\nexports.default = injector;\n\n(0, _dynamicExport2.default)(exports, 'default', function () {\n\treturn injector || (injector = getInjector());\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/angular-es-utils/injector/index.js\n// module id = 7\n// module chunks = 0 1 2 3","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n/**\n * @author Kuitos\n * @homepage https://github.com/kuitos/\n * @since 2016-05-12\n */\n\n/**\n * dynamic export,make the commonjs export has the same behaviour with es module\n * @param exportsRef exports reference\n * @param prop\n * @param getter\n */\nexports.default = function (exportsRef, prop, getter) {\n\n  Object.defineProperty(exportsRef, prop, {\n    get: function get() {\n      return getter.apply(this);\n    }\n  });\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/angular-es-utils/dynamic-export/index.js\n// module id = 8\n// module chunks = 0 1 2 3","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _credentials = require('../credentials');\n\nvar _metadata = require('./metadata');\n\nvar _tokenRefreshInterceptor = require('./token-refresh-interceptor');\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; } /**\n                                                                                                                                                                                                                   * @author qix\n                                                                                                                                                                                                                   * @homepage https://github.com/qixman/\n                                                                                                                                                                                                                   * @since 2016-10-11\n                                                                                                                                                                                                                   */\n\n\nvar needToRefreshToken = false;\n\nexports.default = {\n\n\tbeforeSend: function beforeSend(xhr, config) {\n\n\t\tvar credential = (0, _credentials.getRequestCredential)();\n\t\tvar accessToken = _metadata.CREDENTIAL_KEY_MAPPER.accessToken,\n\t\t    refreshToken = _metadata.CREDENTIAL_KEY_MAPPER.refreshToken,\n\t\t    expireTime = _metadata.CREDENTIAL_KEY_MAPPER.expireTime;\n\n\t\tif (!credential) {\n\t\t\t(0, _tokenRefreshInterceptor.execAuthFailure)(xhr);\n\t\t\treturn;\n\t\t}\n\n\t\txhr.setRequestHeader(_metadata.REQUEST_TOKEN_HEADER, (0, _metadata.REQUEST_TOKEN_VALUE)(credential[accessToken]));\n\t\txhr[_metadata.REQUEST_TOKEN_HEADER] = (0, _metadata.REQUEST_TOKEN_VALUE)(credential[accessToken]);\n\t\tif (credential[refreshToken] && _metadata.REQUEST_WHITE_LIST.indexOf(config.url) === -1) {\n\n\t\t\t// expireTime type is second\n\t\t\tvar expireDateTime = credential[expireTime] * 1000;\n\t\t\tvar now = _metadata.Date.now();\n\n\t\t\t// token失效则直接跳转登录页面\n\t\t\t// token未失效但是可用时长已低于用户会话最短保留时间,则需要刷新token\n\t\t\tif (_metadata.USER_SESSION_AVAILABLE_TIME >= expireDateTime - now && expireDateTime - now >= 0) {\n\t\t\t\tneedToRefreshToken = true;\n\t\t\t} else if (expireDateTime - now < 0) {\n\t\t\t\t// token失效\n\t\t\t\t(0, _tokenRefreshInterceptor.execAuthFailure)(xhr);\n\t\t\t}\n\t\t}\n\t},\n\tcomplete: function complete(xhr) {\n\n\t\t// 如果请求能正常响应,说明 storage 里的状态是存在的,所以这里不做判断\n\t\tvar credential = (0, _credentials.getRequestCredential)();\n\t\tvar accessToken = _metadata.CREDENTIAL_KEY_MAPPER.accessToken,\n\t\t    refreshToken = _metadata.CREDENTIAL_KEY_MAPPER.refreshToken;\n\n\t\tvar $ = window.$;\n\n\t\t// 所有请求结束了才做refreshToken的操作,避免后端因为token被刷新而导致前一请求失败\n\t\tif (needToRefreshToken && $.active <= 1) {\n\t\t\tneedToRefreshToken = false;\n\t\t\t// refresh token\n\t\t\t$.ajax({\n\t\t\t\turl: _tokenRefreshInterceptor.refreshTokenUrl,\n\t\t\t\ttype: 'POST',\n\t\t\t\tdata: {\n\t\t\t\t\trefresh_token: credential[refreshToken],\n\t\t\t\t\tgrant_type: 'refresh_token'\n\t\t\t\t},\n\t\t\t\theaders: _defineProperty({\n\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded'\n\t\t\t\t}, _metadata.REQUEST_TOKEN_HEADER, (0, _metadata.REQUEST_TOKEN_VALUE)(credential[accessToken]))\n\t\t\t}).done(function (response) {\n\t\t\t\t// 更新localStorage中token信息\n\t\t\t\t(0, _credentials.setRequestCredential)(response);\n\t\t\t}).fail(function () {\n\t\t\t\treturn (0, _tokenRefreshInterceptor.execAuthFailure)(xhr);\n\t\t\t});\n\t\t}\n\t}\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/interceptors/token-refresh-interceptor-jq.js\n// module id = 10\n// module chunks = 2 3"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AChCA;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACzHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACpKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;","sourceRoot":""}