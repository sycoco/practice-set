'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _injector = require('../injector');

var _injector2 = _interopRequireDefault(_injector);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function () {
	var delay = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 300;
	var context = arguments[1];
	var invokeApply = arguments[2];
	return function (target, name, descriptor) {

		if (!descriptor) {
			throw new Error('can not use Debounce decorator with a constructor!');
		}

		var fn = descriptor.value || target[name];
		var $timeout = null;
		var pendingDebounce = null;

		descriptor.value = function () {
			var _this = this;

			for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
				args[_key] = arguments[_key];
			}

			// lazy init
			$timeout = $timeout || _injector2.default.get('$timeout');

			$timeout.cancel(pendingDebounce);

			pendingDebounce = $timeout(function () {
				pendingDebounce = null;
				fn.apply(context || _this, args);
			}, delay, invokeApply);
		};

		return descriptor;
	};
}; /**
    * @author Kuitos
    * @homepage https://github.com/kuitos/
    * @since 2016-04-12
    */